<html>

<head>
    <title>progino</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/destyle.css/destyle.css" type="text/css">
    <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css" type="text/css">
</head>

<script>
    window.onload = async () => {
        // get courses list
        const courses = await fetch(
            "/courses",
            {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            }
        );

        /*
        input : {
            "course": "course id",
            "name": "course name",
            "level": course level,
            "problems": [
                problem id,
                problem id,
                ...
            ]
        }
        */

        // courses viewer
        const courseView = document.getElementById("mainContents");
        const coursesList = JSON.parse(JSON.parse(await courses.text()));

        coursesList.forEach(course => {
            const courseRow = document.createElement("tr");
            // create course link
            const courseLink = document.createElement("a");
            courseLink.href = `/course/${course.course}`;
            courseLink.innerText = course.name;
            // create course name cell
            const courseName = document.createElement("td");
            courseName.appendChild(courseLink);
            courseRow.appendChild(courseName);
            // create course level cell
            const courseLevel = document.createElement("td");
            courseLevel.innerText = course.level;
            courseRow.appendChild(courseLevel);
            // append course row to course view
            courseView.appendChild(courseRow);
        });
        
        // user account information
        const userInfo = document.getElementById("userInfo");
        const userName = document.createElement("p");
        // get user name from localStorage.userName
        if(localStorage.getItem("userName") === null) {
            userName.innerText = "Guest";
        } else {
            // check expiration date
            const expirationDate
                = new Date(localStorage.getItem("expirationDate"));
            const now = new Date();
            if(now > expirationDate) {
                // remove user name from localStorage
                localStorage.removeItem("userName");
                userName.innerText = "Guest";
            } else {
                userName.innerText = localStorage.getItem("userName");
            }
        }
        // if user name is not Guest, create logout button
        if(userName.innerText !== "Guest") {
            const logoutButton = document.createElement("button");
            logoutButton.innerText = "ログアウト";
            logoutButton.onclick = () => {
                // remove user name from localStorage
                localStorage.removeItem("userName");
                // redirect to login page
                window.location.href = "/login";
            };
            userInfo.appendChild(userName);
            userInfo.appendChild(logoutButton);
        }
        // if user name is Guest, create login and regiser button
        else {
            const loginButton = document.createElement("button");
            loginButton.innerText = "ログイン";
            loginButton.onclick = () => {
                // redirect to login page
                window.location.href = "/login";
            };
            const registerButton = document.createElement("button");
            registerButton.innerText = "新規登録";
            registerButton.onclick = () => {
                // redirect to register page
                window.location.href = "/register";
            };
            userInfo.appendChild(userName);
            userInfo.appendChild(loginButton);
            userInfo.appendChild(registerButton);
        }
    }
</script>

<body>
    <header>
        <table>
            <tbody>
                <tr>
                    <td>
                        <h1 onclick="location.href='/'">
                            progino
                        </h1>
                        <p>
                            study for "using".
                        </p>
                    </td>
                    <td>
                        <span id="userInfo"></span>
                    </td>
                </tr>
            </tbody>
        </table>
    </header>
    <table>
        <tbody>
            <tr>
                <td>
                    <h2>
                        メインコンテンツ
                    </h2>
                    <table>
                        <thead>
                            <tr>
                                <th>
                                    コース名
                                </th>
                                <th>
                                    レベル
                                </th>
                            </tr>
                        </thead>
                        <tbody id="mainContents">
                        </tbody>
                    </table>
                </td>
            </tr>
            <tr>
                <td id="subContents">
                    <h2>
                        サブコンテンツ
                    </h2>
                </td>
            </tr>
        </tbody>
    </table>
</body>

</html>